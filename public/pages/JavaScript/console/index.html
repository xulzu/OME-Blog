<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>你没注意的浏览器console.log「异步打印现象」 | OME`s Blog</title>
    <meta name="generator" content="VuePress 1.6.0">
    
    <meta name="description" content="">
    <link rel="preload" href="/guizai-blog/assets/css/0.styles.f9d8be58.css" as="style"><link rel="preload" href="/guizai-blog/assets/js/app.ca261363.js" as="script"><link rel="preload" href="/guizai-blog/assets/js/7.e617a03c.js" as="script"><link rel="preload" href="/guizai-blog/assets/js/5.8d159202.js" as="script"><link rel="preload" href="/guizai-blog/assets/js/6.405f90fa.js" as="script"><link rel="preload" href="/guizai-blog/assets/js/12.7d642952.js" as="script"><link rel="preload" href="/guizai-blog/assets/js/4.9bdf1d18.js" as="script"><link rel="prefetch" href="/guizai-blog/assets/js/10.6d10a414.js"><link rel="prefetch" href="/guizai-blog/assets/js/11.6355e75e.js"><link rel="prefetch" href="/guizai-blog/assets/js/13.c512d88c.js"><link rel="prefetch" href="/guizai-blog/assets/js/14.f6fa1c7a.js"><link rel="prefetch" href="/guizai-blog/assets/js/15.a10e4d7a.js"><link rel="prefetch" href="/guizai-blog/assets/js/16.3b93e86a.js"><link rel="prefetch" href="/guizai-blog/assets/js/17.324bdfd9.js"><link rel="prefetch" href="/guizai-blog/assets/js/18.4b0b6d72.js"><link rel="prefetch" href="/guizai-blog/assets/js/19.f512b5d6.js"><link rel="prefetch" href="/guizai-blog/assets/js/2.1ac4e82f.js"><link rel="prefetch" href="/guizai-blog/assets/js/20.3ba4e1c9.js"><link rel="prefetch" href="/guizai-blog/assets/js/21.52058e60.js"><link rel="prefetch" href="/guizai-blog/assets/js/22.c0031b3e.js"><link rel="prefetch" href="/guizai-blog/assets/js/23.691f5dee.js"><link rel="prefetch" href="/guizai-blog/assets/js/24.169d3ea5.js"><link rel="prefetch" href="/guizai-blog/assets/js/25.08212d62.js"><link rel="prefetch" href="/guizai-blog/assets/js/3.72e15754.js"><link rel="prefetch" href="/guizai-blog/assets/js/8.fb13aa8a.js"><link rel="prefetch" href="/guizai-blog/assets/js/9.983fb88a.js">
    <link rel="stylesheet" href="/guizai-blog/assets/css/0.styles.f9d8be58.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><main class="md-content"><div style="width:100%"><div class="xu-footer" data-v-4e486c50>
	OME`s Blog
</div> <div class="Nav-bar" data-v-db0d137e><nav data-v-db0d137e><a href="/guizai-blog/" title="文章" class="nav" data-v-db0d137e>Article</a><a href="/guizai-blog/category" title="分类" class="nav" data-v-db0d137e>Category</a><a href="/guizai-blog/about" title="关于" class="nav" data-v-db0d137e>About</a></nav></div> <!----> <!----> <div class="content__default"><h1 id="你没注意的浏览器console-log「异步打印现象」"><a href="#你没注意的浏览器console-log「异步打印现象」" class="header-anchor">#</a> 你没注意的浏览器console.log「异步打印现象」</h1> <h2 id="结论"><a href="#结论" class="header-anchor">#</a> 结论</h2> <blockquote><p>针对在浏览器控制台出现打印结果和代码执行顺序不一致这种「异步现象」。网上主要有两种说法，笔者这里更喜欢第一种，好理解且符合笔者的测试</p> <ul><li>浏览器出于优化的目地，默认不会展开所有对象，只有当手动点击展开时才去”读取对应的值“来进行展示。「点击」是一个代码执行完成之后的行为，所以对深层对象的打印总是最后时刻的快照。</li> <li>不同的浏览器可能有自己的console.log实现机制，受限于I/O性能可能打印的时机会与代码执行的时机不匹配。也就是说如果打印的时机如果较为靠后，那么打印时因为引用型的数据发生了修改，所以出现改变前后打印结果都一致的现象</li></ul></blockquote> <h2 id="正文"><a href="#正文" class="header-anchor">#</a> 正文</h2> <p><code>console.log</code>是日常开发中用的较多的调试技巧。我们都知道他能把信息打印到控制台中。考虑下面的例子</p> <div class="language-js extra-class"><pre class="language-js"><code>			<span class="token keyword">const</span> a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
			a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token operator">++</span><span class="token punctuation">;</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在我们的认为中应该先后打印</p> <div class="language-js extra-class"><pre class="language-js"><code>			<span class="token comment">// [{name:0}]</span>
			<span class="token comment">// [{name:1}] </span>
</code></pre></div><p>但是经笔者实际实验下来 「谷歌浏览器版本 93.0.4577.82（正式版本） (x86_64)」 。实际打印的和感觉上的差别很大,实际打印了</p> <div class="language-js extra-class"><pre class="language-js"><code>			<span class="token comment">// [{name:1}]</span>
			<span class="token comment">// [{name:1}] </span>
</code></pre></div><p>从这个结果看，好似console.log是一个异步的方法，打印是在代码执行完之后才进行的操作。
从「你不知道的JavaScript中卷」翻阅到</p> <blockquote><p>并没有什么规范或一组需求指定console.* 方法族如何工作——它们并不是JavaScript 正式
的一部分，而是由宿主环境（请参考本书的“类型和语法”部分）添加到JavaScript 中的。因此，不同的浏览器和JavaScript 环境可以按照自己的意愿来实现，有时候这会引起混淆。
尤其要提出的是，在某些条件下，某些浏览器的console.log(..) 并不会把传入的内容立即输出。出现这种情况的主要原因是，在许多程序（不只是JavaScript）中，I/O 是非常低速的阻塞部分。所以，（从页面/UI 的角度来说）浏览器在后台异步处理控制台I/O 能够提高性能，这时用户甚至可能根本意识不到其发生。</p></blockquote> <p>好吧，上面一大段看的头疼。但大概意思就是说不同的浏览器可能有自己的console.log实现机制，受限于I/O性能可能打印的时机会与代码执行的时机不匹配。也就是说如果打印的时机如果较为靠后，那么打印时因为引用型的数据发生了修改，所以出现改变前后打印结果都一致的现象。这么一说貌似也能说的通。我们在看看下一个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code>		<span class="token keyword">const</span> c<span class="token operator">=</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
		c<span class="token punctuation">.</span>age<span class="token operator">++</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//先后的打印结果为</span>
		<span class="token comment">//{age: 0}</span>
		<span class="token comment">//{age: 1}</span>
</code></pre></div><p>看到这属实蚌埠住了，为啥这个例子又能符合我们的逻辑认知呢？运行示例代码看下图</p> <div class="language-js extra-class"><pre class="language-js"><code>
		<span class="token keyword">const</span> a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token string">'初始：0 pre-a需展开'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token operator">++</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token string">'初始：0 after-a需展开'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> b<span class="token operator">=</span><span class="token punctuation">{</span>info<span class="token operator">:</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token string">'初始：0 pre-b需展开'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		b<span class="token punctuation">.</span>info<span class="token punctuation">.</span>age<span class="token operator">++</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token string">'初始：0 after-b需展开'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> c<span class="token operator">=</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token string">'初始：0 pre-c不需展开'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		c<span class="token punctuation">.</span>age<span class="token operator">++</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token string">'初始：0 after-c不需展开'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/guizai-blog/assets/img/console.0c162dcb.jpg" alt="console"></p> <p>有什么共通之处？从图中可以看出浏览器控制对于对象和数组只能默认展开第一层，更深的对象是用“...&quot;表示的。**因此这里就有另一种说法，浏览器出于优化的目地，默认不会展开所有对象，只有当手动点击展开时才去”读取对应的值“来进行展示。**这么一来上面的所有的示例在这个角度也能说的通。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li>你不知道的JavaScript中卷</li> <li><a href="https://juejin.cn/post/6956103205650432037" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6956103205650432037<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <div class="xu-footer" data-v-4b773789>
	lisence -_- @2020-01-23 OME
</div></main></div><div class="global-ui"></div></div>
    <script src="/guizai-blog/assets/js/app.ca261363.js" defer></script><script src="/guizai-blog/assets/js/7.e617a03c.js" defer></script><script src="/guizai-blog/assets/js/5.8d159202.js" defer></script><script src="/guizai-blog/assets/js/6.405f90fa.js" defer></script><script src="/guizai-blog/assets/js/12.7d642952.js" defer></script><script src="/guizai-blog/assets/js/4.9bdf1d18.js" defer></script>
  </body>
</html>
